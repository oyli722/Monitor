# 项目名称：服务运维监控系统

## 一、项目概述

**核心定位**：一个采用客户端-服务端架构的运维系统，集成主机监控、数据可视化、Web SSH终端与AI助手，旨在提供一站式的服务器资源监控与自动化运维体验。

**核心价值**：

- **集中监控**：统一纳管多台服务器的基础硬件信息与实时运行指标。
- **便捷运维**：通过Web界面实现SSH快捷登录与终端操作，无需本地客户端。
- **智能辅助**：通过自然语言与AI交互，自动化执行主机注册、连接、命令执行等常见运维操作，降低操作门槛。

**目标用户**：系统管理员、运维工程师、开发人员等需要对服务器集群进行监控和操作的技术人员。

## 二、系统架构总览

**架构风格**：客户端-服务端架构，包含三个核心组件。

1. **客户端（Agent）**：部署于被监控主机，负责数据采集与上报。
2. **服务端（Server Core）**：系统中枢，负责数据处理、连接代理与API提供。
3. **前端（Web Console）**：提供统一的可视化操作界面。

## 三、核心模块与功能详述

### 模块一：客户端代理

**模块职责**：安装在目标主机上的轻量级代理，负责本机信息采集与通信。
**功能列表**：

1. **静态信息采集**：在启动时采集并生成主机“基本数据”，包括：
   - 主机ID（唯一标识）、主机名称
   - IP地址、CPU型号、显卡型号
   - 内存总容量、硬盘总容量
2. **动态监控采集**：定时采集主机“运行时数据”，包括：
   - CPU使用率
   - 网络上行与下行速度
   - 磁盘空间占用率
   - 内存占用率
3. **服务端通信**：
   - **注册**：启动时向服务端注册并上报“基本数据”。
   - **定时上报**：以固定频率向服务端上报“运行时数据”。

### 模块二：服务端核心

**模块职责**：接收、存储数据，管理客户端，并提供所有核心功能的API支撑。
**功能列表**：

1. **客户端管理**：
   - 接收并验证客户端注册，维护在线客户端清单。
   - 记录所有客户端的基本信息与状态（在线/离线）。
2. **数据服务**：
   - 接收并存储客户端上报的定时监控数据。
   - 为前端图表展示和历史查询提供数据接口。
3. **SSH代理与隧道**：
   - 作为安全的SSH中继，转发前端发起的SSH连接到目标客户端主机。
   - 安全存储和管理各主机的SSH连接凭证（用户名、密码），支持首次输入后保存。
4. **AI指令执行接口**：
   - 提供标准API，供AI Agent调用以执行底层操作，如：根据主机ID建立SSH连接、在指定连接中执行命令等。

### 模块三：前端可视化与控制台

**模块职责**：提供用户交互界面，集成数据展示与运维操作。
**功能列表**：

1. **监控数据可视化**：
   - **主机概览面板**：展示所有已注册主机的列表及其核心状态（如资源负载快照、在线状态）。
   - **主机详情仪表盘**：针对单台主机，以趋势图、仪表盘等形式展示其“运行时数据”，包括：
     - CPU使用率历史曲线
     - 内存占用率变化
     - 磁盘占用率
     - 网络流量（上行/下行）图表
2. **集成SSH终端**：
   - **快捷连接**：在主机列表旁提供“连接”按钮，对已保存凭证的主机实现一键连接，打开Web终端。
   - **多会话管理**：支持同时打开多个独立终端窗口，分别连接不同主机。
   - **凭证管理**：提供界面供用户为每台主机首次连接时输入或后续修改SSH凭证。
3. **AI运维助手**：提供两种AI助手场景，满足不同使用需求
   - **侧边栏AI助手**（全局）：通用AI对话，支持多会话管理，通过HTTP REST API通信
   - **主机详情页AI助手**（SSH绑定）：与SSH终端绑定的AI助手，支持自然语言执行SSH命令并分析结果，通过WebSocket实时通信

### 模块四：AI运维助手

**模块职责**：作为智能层，理解用户自然语言指令，并驱动服务端执行相应运维操作。

系统提供两种AI助手场景，满足不同的使用需求：

#### 场景A：侧边栏AI助手（全局通用对话）

**功能特点**：
- **多会话管理**：支持创建、切换、删除多个独立对话会话
- **通用AI对话**：提供智能问答、技术咨询等通用AI能力
- **主机关联**：可选将主机关联到会话，提供上下文相关的AI建议
- **通信方式**：HTTP REST API（请求-响应模式）
- **消息存储**：Redis持久化，支持历史消息加载

**核心能力**：
- 连续对话理解与上下文保持
- 技术问题解答与建议
- 运维知识查询

#### 场景B：主机详情页AI助手（SSH绑定）

**功能特点**：
- **SSH终端绑定**：与特定主机的SSH终端会话绑定
- **自然语言命令执行**：用户可通过自然语言让AI执行SSH命令
- **实时命令输出**：命令执行结果实时推送到前端显示
- **AI智能分析**：命令执行完成后，AI自动分析结果并给出建议
- **通信方式**：WebSocket长连接（实时双向通信）
- **消息存储**：Redis持久化

**核心能力**：
- 连续对话理解与上下文保持
- SSH会话生命周期管理
- 远程命令执行与结果分析

**技术实现**：
- 后端：AiSshAssistantController（HTTP握手）+ AiSshAssistantHandler（WebSocket）
- 前端：AiAssistantDialog.vue（非模态对话框）+ useAiChat.ts（WebSocket管理）
- AI模型：LangChain4j + 工具调用（SshExecuteTool）
- 命令上下文管理：CommandContextManager（命令注册、输出关联、完成检测、AI分析触发）

------

### 二、主应用框架布局（登录后）

采用经典的三段式布局：

text

```
+-----------------------------------------------------+
|  顶部导航栏 (Header)                                |
+-----------------------------------------------------+
|  |                                                  |
|  |                                                  |
|侧|                    主内容区                      |
|边|                    (Main View)                   |
|栏|                                                  |
|  |                                                  |
|  |                                                  |
+-----------------------------------------------------+
```



#### 1. **顶部导航栏 (Header)**

- **左侧**：系统Logo + 项目名称（点击可返回主页）
- **中部**：全局搜索栏（可选，用于快速搜索主机）
- **右侧**：用户功能区
  - **消息通知图标**（铃铛图标）：显示系统告警/通知数量，点击下拉展示列表
  - **用户头像/用户名**：点击触发下拉菜单：
    - 菜单项：`个人中心`、`修改密码`、`退出登录`
    - 点击`退出登录`：清除本地Token，跳转至登录页

#### 2. **侧边栏 (Sidebar)**

- 采用可折叠的垂直菜单
- **核心菜单项**：
  1. **仪表盘** (Dashboard) - 默认选中
     - 图标：📊
     - 点击进入主机概览页
  2. **主机监控** (Hosts)
     - 图标：🖥️
     - 点击进入主机列表页面
  3. **AI对话** (AI Assistant)
     - 图标：🤖
     - 点击进入侧边栏AI助手页面（多会话管理）
  4. **系统管理** (Admin) - 仅管理员可见
     - 图标：⚙️
     - 子菜单：`用户管理`、`系统设置`

## 页面布局

### 登录功能

#### 登录组件

##### 页面定位

- **系统唯一认证入口**
- 未认证用户访问任何页面时的强制跳转目标
- 包含登录、注册、密码找回三大入口

##### 核心功能模块

1. **主登录表单**
   - 用户名/邮箱输入
   - 密码输入（带显示/隐藏切换）
   - “记住我”选项
   - 登录提交按钮
2. **辅助功能入口**
   - “注册账号”链接 → 跳转至注册流程
   - “忘记密码？”链接 → 触发密码重置流程
3. **系统标识区域**
   - 系统Logo
   - 系统名称展示

##### 交互逻辑

1. **输入验证**
   - 实时表单验证
   - 明确错误提示
   - 提交前完整性检查
2. **状态管理**
   - 登录中/加载状态显示
   - 成功/失败反馈
   - 自动跳转控制
3. **用户体验优化**
   - 键盘快捷键支持
   - 响应式布局适配
   - 过渡动画效果

##### 安全与权限

1. **访问控制**
   - 认证状态检查
   - Token失效处理
   - 安全跳转保护
2. **凭证管理**
   - 本地存储策略（记住我选项）
   - 会话管理
   - 自动填充控制

##### 流程衔接

- **登录成功** → 仪表盘主页
- **注册流程** → 注册页面 → 邮箱激活 → 返回登录
- **密码找回** → 重置流程 → 返回登录

#### 注册组件

##### 页面构成

1. **注册表单主体**
   - 用户名输入（需唯一性校验）
   - 邮箱输入（格式校验+唯一性）
   - 密码设置（含确认密码）
   - 验证码输入（图形或邮箱验证码）
   - 用户协议同意复选框
2. **操作控件**
   - “提交注册”按钮
   - “返回登录”链接

##### 核心流程

1. **用户填写** → 实时表单验证
2. **提交校验** → 服务端验证数据
3. **结果反馈** → 成功跳转/失败提示

##### 后续流向

- **注册成功** → 提示激活邮件 → 自动返回登录页
- **返回登录** → 直接跳转登录页面

##### 用户权限

- 新账户默认为普通用户
- 初始无主机访问权限（需管理员分配）

#### 忘记密码组件

##### 页面定位

- 已注册用户的密码重置入口
- 从登录页面“忘记密码？”链接触发
- 独立流程，完成后返回登录页

##### 核心功能模块

1. **身份验证表单**
   - 邮箱地址输入框（接收重置链接）
   - 图形验证码（防恶意请求）
2. **重置流程控制**
   - “发送重置邮件”按钮
   - 倒计时显示（防重复发送）
   - “返回登录”链接

##### 交互流程

1. **步骤1：身份验证**
   - 用户输入注册邮箱
   - 点击发送按钮
2. **步骤2：邮件发送**
   - 按钮变为“已发送”+倒计时
   - 显示提示：“重置链接已发送至邮箱”
3. **步骤3：邮件处理**
   - 用户点击邮件中的重置链接
   - 跳转至密码重置页面（含时效性Token）

##### 安全措施

- 链接有效期：24小时
- 单邮箱发送频率限制
- Token一次性使用

### 主页

1. **顶部导航栏**
   - 系统Logo、全局搜索、用户菜单、通知中心
2. **侧边导航菜单**
   - 系统功能模块入口（可折叠）
3. **主内容区**
   - 动态加载各功能页面内容

#### 顶部导航栏组件

##### 左侧区域

- 系统Logo（可点击返回首页）
- 系统名称/简称显示

##### 中部区域

- 快捷搜索主机
- 搜索时可以筛选主机

##### 右侧区域

1. **用户功能区**

   - 用户头像/名称
   - 下拉菜单：个人中心、设置、退出登录

2. **通知中心**

   - 铃铛图标 + 未读计数
   - 通知消息下拉面板

3. **系统工具**

   - 主题切换（亮/暗模式）

     

#### 侧边导航栏

##### **仪表盘**（Dashboard）

##### **主机管理**（Host Management）

##### **AI助手**（AI Assistant）

##### **用户权限管理**（User & Permission）

##### **系统设置**（System Settings）

##### 帮助文档（Help & Documentation）

#### 主内容区

##### 仪表盘

**功能点：**

- 系统运行概览
- 关键指标汇总

**全局统计卡片区**

- **主机总数**（在线/离线数量）
- **离线主机数**（触发告警的主机）
- 其余功能待定

##### 主机管理

**功能点：**

- 主机列表与状态
- 监控数据查看

- 主机配置管理

- 所有受监控主机的集中管理界面
- 主机状态查看、筛选、操作的统一入口

**列表视图：**

- **表格/卡片展示**：点击主机，弹出主机详情面板
- **快速筛选**：按状态（在线/离线）、标签、分组、资源使用率筛选

**主机详情面板：**

* **基本信息**：硬件配置、操作系统

- **实时监控**：CPU、内存、磁盘、网络实时图表
- **操作**：SSH连接、删除、修改主机名称

**主机分组管理**：

- **分组视图**：按业务等维度分组展示
- **拖拽分组**：可视化拖拽主机到不同分组
- **分组操作**：对整组主机执行批量操作

**主机注册流程：**

- 输入IP，token进行注册

##### 用户权限管理

**功能点：**

- 用户账号管理
- 角色权限配置
- 操作日志审计

#### AI助手

系统提供两种AI助手场景，满足不同的使用需求：

---

##### 场景一：侧边栏AI助手（全局）

**访问入口**：点击侧边栏菜单"AI对话"（图标：🤖）

**功能特点**：
- **多会话管理**：支持创建、切换、删除多个对话会话
- **会话列表**：左侧面板显示所有历史对话，按时间排序
- **消息历史**：自动加载会话的完整消息历史
- **Markdown渲染**：支持代码高亮和格式化显示
- **主机关联**：可选将主机关联到会话（通过API）

**UI布局**：
```
┌─────────────────────────────────────────────────────────────┐
│  侧边栏面板 (280px)     │    主聊天区域 (自适应)              │
│  ┌──────────────────┐  │  ┌──────────────────────────────┐  │
│  │ [新对话] 按钮     │  │  │  消息列表滚动区               │  │
│  ├──────────────────┤  │  │  ┌────────────────────────┐  │  │
│  │ 会话列表          │  │  │  │ 用户: 查看磁盘使用     │  │  │
│  │ ├─ 对话1         │  │  │  ├────────────────────────┤  │  │
│  │ ├─ 对话2 (active)│  │  │  │ AI: 磁盘使用情况如下... │  │  │
│  │ └─ ...           │  │  │  └────────────────────────┘  │  │
│  └──────────────────┘  │  │  输入框 + 发送按钮             │  │
│                        │  └──────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

**通信方式**：HTTP REST API
- 创建会话、获取会话列表、发送消息等
- 无需WebSocket连接

---

##### 场景二：主机详情页AI助手（SSH绑定）

**访问入口**：
1. 打开主机详情页
2. 点击"连接SSH"建立终端连接
3. 点击"AI助手"按钮打开非模态对话框

**功能特点**：
- **单会话模式**：与SSH终端绑定的AI助手
- **WebSocket通信**：实时双向通信，低延迟
- **SSH命令执行**：AI可通过自然语言执行SSH命令
- **命令输出展示**：实时显示命令执行输出
- **AI结果分析**：命令完成后自动触发AI分析
- **非模态对话框**：可同时操作SSH终端和AI助手
- **可拖动**：对话框可自由拖动位置

**UI布局**：
```
┌─────────────────────────────────────────────────────────────┐
│  主机详情页                                                  │
│    ┌─────────────────┐  ┌─────────────────────────────────┐ │
│    │  SSH终端窗口     │  │  AI助手面板（可拖动）            │ │
│    │  (xterm.js)      │  │  - 连接状态栏                   │ │
│    │                 │  │  - 消息输入框                   │ │
│    │  $ ls -la       │  │  - AI回复展示（Markdown渲染）   │ │
│    │                 │  │  - 命令输出显示                 │ │
│    └─────────────────┘  └─────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

**使用流程**：
1. 用户打开主机详情页，连接SSH终端
2. 点击"AI助手"按钮，建立AI助手连接
3. 与AI对话，例如："帮我查看CPU使用率"
4. AI执行命令（如：`top -n 1`），实时显示输出
5. 命令完成后，AI自动分析结果并给出建议

**通信方式**：WebSocket长连接
- 实时双向通信
- 支持命令输出流式推送
- 支持AI分析结果异步推送

---

##### 技术对比

| 特性 | 侧边栏AI助手 | 主机详情页AI助手 |
|------|-------------|-----------------|
| **位置** | 全局侧边栏菜单 | 主机详情页对话框 |
| **路由** | `/ai` | 无（嵌入对话框） |
| **通信方式** | HTTP REST API | WebSocket长连接 |
| **会话类型** | 多会话管理 | 单会话（与SSH绑定） |
| **主机关联** | 可选 | 必需（通过SSH Session） |
| **SSH命令执行** | 不支持 | 支持 |
| **命令输出展示** | 无 | 实时输出 |
| **AI结果分析** | 无 | 自动分析 |
| **后端Controller** | ChatController | AiSshAssistantController |
| **后端Service** | ChatService | AiSshAssistantService |
| **Redis前缀** | `assistant:session:*` | `ai:ssh:*` |

