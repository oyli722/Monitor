# 迭代文档 V1.1

**文档版本**：V1.1
**更新日期**：2026-02-02
**项目版本**：V1.1
**开发模式**：个人开发

---

## 版本概述

**版本目标**：集成 AI 助手功能，优化 WebSocket 架构，修复已知缺陷

**主要变更摘要**：
- 新增 AI 助手功能（主机集成 + 侧边栏集成）
- 优化后端 WebSocket 结构（使用 @ServerEndpoint 注解）
- 修复 SSH 终端显示异常问题

---

## 新增功能

### 功能1：AI助手功能

#### 1.1 主机集成

| 字段 | 内容 |
|------|------|
| **功能描述** | 在主机详情中集成 AI 助手，支持通过自然语言指令对主机进行管理和操作 |
| **用户价值** | 降低运维操作门槛，通过自然语言即可完成复杂的主机管理操作 |
| **涉及模块** | 前端：`HostDetailDialog.vue`、新增 AI 对话组件；后端：新建 AI 模块 |
| **依赖** | AI 模型集成、工具调用框架 |

**功能详情**：
- **触发方式**：在主机卡片/详情中点击"AI 帮助"按钮
- **交互方式**：弹出对话框界面
- **输入方式**：用户输入自然语言指令
- **执行流程**：
  1. AI 解析用户指令
  2. 调用对应工具执行操作
  3. 返回执行结果
- **支持操作**：
  - 自动连接 SSH
  - 执行 Shell 命令
  - 分析返回的数据

**实现方案**：
- 前端：新建 `HostAiDialog.vue` 组件，集成自然语言输入界面
- 后端：新建 AI 模块，实现指令解析和工具调用
- 工具集成：SSH 连接、命令执行、数据分析等工具封装

---

#### 1.2 侧边栏集成

| 字段 | 内容 |
|------|------|
| **功能描述** | 在侧边栏集成独立的 AI 助手，提供通用的聊天、问答、代码生成功能 |
| **用户价值** | 提供便捷的 AI 辅助，支持通用对话和知识查询 |
| **涉及模块** | 前端：侧边栏新增 AI 入口；后端：AI 模块 |
| **依赖** | AI 模型集成 |

**功能详情**：
- **触发方式**：点击侧边栏"AI 助手"菜单项
- **交互方式**：独立的聊天界面
- **支持功能**：
  - 聊天对话
  - 知识问答
  - 代码生成（无关具体项目配置）
- **历史管理**：
  - 支持回退到某个历史对话
  - 从回退点重新生成
  - 重新生成后，该点之后的消息消失

**实现方案**：
- 前端：新建 `AIAssistant.vue` 页面或侧边栏组件
- 后端：会话管理、消息存储、历史回溯接口
- 数据存储：对话历史持久化（数据库或文件）

---

## 功能优化

### 优化1：WebSocket 结构优化

| 字段 | 内容 |
|------|------|
| **优化描述** | 重构后端 WebSocket 处理逻辑，使用 Spring Boot @ServerEndpoint 注解 |
| **优化原因** | 当前结构不够清晰，需要更规范、更易维护的实现方式 |
| **涉及模块** | 后端：`SshWebSocketHandler` 及相关类 |
| **技术方案** | 使用 @ServerEndpoint 注解，不引入额外框架 |

**当前问题**：
- WebSocket 处理逻辑结构不够清晰
- 代码可读性和可维护性有待提升

**优化方案**：
- 使用 Spring Boot 提供的 `@ServerEndpoint` 注解
- 通过注解方式标识 WebSocket 端点
- 方法级别的路径映射，代码更清晰
- 保持现有功能不变

**预期收益**：
- 代码结构更清晰
- 更容易理解和维护
- 符合 Spring Boot 最佳实践

---

## 问题修复

### 修复1：SSH终端显示异常

| 字段 | 内容 |
|------|------|
| **缺陷编号** | SSH-001 |
| **缺陷标题** | SSH 终端显示异常 |
| **缺陷类型** | UI/体验问题 |
| **严重程度** | 低 |
| **涉及组件** | `Monitor-Web/src/components/monitor/TerminalPanel.vue` |

**问题描述**：

**问题1：白色输入框异常**
- 位置：出现在终端最上方
- 行为：可以在白色输入框内输入，输入的内容会在终端中显示
- 变化：随着终端显示内容增多，白色输入框会向下移动，上方出现更多空白区域

**问题2：视角跳转**
- 现象：光标本身始终停留在最下方（未跳转）
- 问题：当终端显示内容过多时，视角会跳转到上方，导致看不到当前输入位置

**复现步骤**：
1. 连接 SSH 终端
2. 输入命令或查看大量输出内容
3. 观察终端上方的白色输入框和视角变化

**修复方案**：待定（需要进一步排查确认）

**影响范围**：仅影响用户体验，不影响功能使用

---

## 已知问题

| 问题编号 | 问题描述 | 状态 |
|----------|----------|------|
| - | 本版本暂无其他已知问题 | - |

---

## 更新记录

| 版本 | 日期 | 更新内容 | 操作人 |
|------|------|----------|--------|
| V1.1 | 2026-02-02 | 初始版本，规划 V1.1 迭代内容 | - |
